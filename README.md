```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•—â–‘â–‘â–‘â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ•—â–‘â–‘â–‘â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘â•šâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•”â•
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘â–‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–‘
â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â•šâ–ˆâ–ˆâ•”â•â–‘â–‘
â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘
â•šâ•â•â–‘â–‘â•šâ•â•â–‘â•šâ•â•â•â•â•â•â–‘â•šâ•â•â•â•â•â•â•â–‘â–‘â–‘â•šâ•â•â–‘â–‘â–‘
```

## ğŸš€ Quick Install

### Option 1: Install from RubyGems (When Published)

```bash
gem install ruly
```

### Option 2: Install from GitHub with Default Rules

```bash
# Clone with submodules to get the default rules
git clone --recursive git@github.com:patrickclery/ruly.git
cd ruly
gem build ruly.gemspec
gem install ruly-*.gem
```

### Option 3: Install Without Rules

```bash
# Clone without submodules
git clone git@github.com:patrickclery/ruly.git
cd ruly
gem build ruly.gemspec
gem install ruly-*.gem
# Then set up your own rules (see Setting Up Your Rules section)
```

### Getting Started

After installation, you can immediately start using Ruly:

```bash
# List available commands
$ ruly help

# Combine all rules into one file
$ ruly squash

# Use a specific recipe
$ ruly squash --recipe rails

# Clean up generated files
$ ruly clean

# List available recipes
$ ruly list-recipes

# Show version
$ ruly version
```

## ğŸŒŸ How It Works

### Ruby Gem CLI Tool

Ruly is a global command-line tool installed via Ruby gems:

1. **One-time Installation**: Install globally with `gem install ruly`
2. **Available Everywhere**: The `ruly` command works in any directory
3. **Recipe System**: Use pre-configured recipes or create your own
4. **Smart Caching**: Cache compiled recipes for performance
5. **Multiple Formats**: Support for different AI assistants (Claude, Cursor, etc.)

**Benefits:**

- âœ… **Global CLI tool**: Available system-wide after installation
- âœ… **Easy updates**: Update with `gem update ruly`
- âœ… **No project dependencies**: Works independently in any directory
- âœ… **Flexible rules system**: Define your own rules repository or use remote sources
- âœ… **Cross-platform**: Works anywhere Ruby is installed

### What Ruly Does

**The `ruly` command provides:**

- âœ… Combine multiple rule files into one document
- âœ… Use recipe collections for different contexts
- âœ… Fetch and include remote GitHub files
- âœ… Cache compiled recipes for performance
- âœ… Support for Claude, Cursor, and other AI assistants
- âœ… Clean up all agent-related files automatically

**Generated Files:**

```
your-project/
â”œâ”€â”€ CLAUDE.local.md      # Generated by ruly squash (default)
â”œâ”€â”€ .ruly.yml            # Metadata for clean command
â””â”€â”€ .claude/
    â””â”€â”€ commands/        # Command files for Claude agent
        â”œâ”€â”€ bug/         # Bug-related commands
        â”œâ”€â”€ pr/          # PR management commands
        â”œâ”€â”€ testing/     # Testing commands
        â””â”€â”€ workflow/    # Workflow commands
```

For other agents:

- **Cursor**: Uses `.cursor/` directory with `.mdc` files
- **Custom**: Specify with `--agent` and `--output-file` options

---

## About Ruly

Ruly is a powerful CLI tool that manages AI assistant rules and configurations for software development projects. It provides a framework for organizing and combining rule files from various sources - your own private repositories, public GitHub repos, or local files - into a single document for AI assistants like Claude or Cursor.

### âš ï¸ Important: Rules Not Included

This repository **does not include rule files**. You need to:

1. Create your own rules repository (private or public)
2. Clone this repo with submodules if you have access to the default rules
3. Configure recipes to point to your rule sources

## ğŸ¯ Setting Up Your Rules

### Option 1: Create Your Own Rules Repository

1. **Create a new repository for your rules:**

   ```bash
   # Create a private repository
   gh repo create yourusername/rules --private --description "My AI assistant rules"

   # Clone it locally
   git clone git@github.com:yourusername/rules.git
   cd rules
   ```

2. **Organize your rules:**

   ```
   rules/
   â”œâ”€â”€ ruby/
   â”‚   â”œâ”€â”€ common.md
   â”‚   â”œâ”€â”€ rspec.md
   â”‚   â””â”€â”€ best-practices.md
   â”œâ”€â”€ testing/
   â”‚   â””â”€â”€ patterns.md
   â”œâ”€â”€ commands/
   â”‚   â”œâ”€â”€ bug/
   â”‚   â”‚   â””â”€â”€ diagnose.md
   â”‚   â””â”€â”€ pr/
   â”‚       â””â”€â”€ create.md
   â””â”€â”€ core/
       â””â”€â”€ debugging.md
   ```

### Option 2: Use Multiple Rule Sources

Create `~/.config/ruly/recipes.yml` to combine rules from different repositories:

```yaml
recipes:
  my-complete-rules:
    description: "Combines personal and company rules"
    sources:
      # Your personal rules repository
      - github: yourusername/rules
        branch: main
        rules:
          - ruby
          - testing
          - commands

      # Company rules (e.g., "FakeCorp")
      - github: fakecorp/development-standards
        branch: main
        rules:
          - guidelines/code-review.md
          - guidelines/security.md

      # Individual files from public repos
      - https://github.com/thoughtbot/guides/blob/main/ruby/README.md
```

### Option 3: Use Remote Sources Only

If you don't want to maintain your own rules repository, you can use rules directly from GitHub:

```yaml
recipes:
  remote-only:
    description: "Rules from various GitHub sources"
    sources:
      # Individual files
      - https://github.com/rubocop/ruby-style-guide/blob/master/README.md
      - https://github.com/testdouble/standard/blob/main/docs/README.md

      # Entire directories (expands to all .md files)
      - https://github.com/fakecorp/standards/tree/main/ruby
      - https://github.com/fakecorp/standards/tree/main/testing
```

### Example: Setting Up Like patrickclery/rules

Here's how the maintainer set up their private rules repository:

1. **Created a private repository:**

   ```bash
   gh repo create patrickclery/rules --private --description "Private rules for Ruly gem"
   ```

2. **Moved existing rules:**

   ```bash
   # Copy rules to new repo
   cp -r ruly/rules/* rules/
   cd rules
   git init
   git add -A
   git commit -m "Initial commit: Move rules from ruly repository"
   git remote add origin git@github.com:patrickclery/rules.git
   git push -u origin main
   ```

3. **Added as submodule to ruly:**

   ```bash
   cd ruly
   git rm -r rules/
   git commit -m "Remove rules directory"
   git submodule add git@github.com:patrickclery/rules.git rules
   git commit -m "Add rules as submodule"
   ```

4. **Combined with work repository (FakeCorp example):**

   ```yaml
   # ~/.config/ruly/recipes.yml
   recipes:
     complete:
       description: "Personal + FakeCorp rules"
       sources:
         - github: patrickclery/rules
           branch: main
           rules:
             - ruby
             - testing
             - commands

         - github: fakecorp/cursor-rules
           branch: main
           rules:
             - workflow
             - jira
   ```

## ğŸ“ Using Ruly Commands

Ruly provides a powerful CLI for managing and compiling your AI assistant rules.

### Basic Commands

**Combine all rules into one file:**

```bash
ruly squash
```

**Use a specific recipe:**

```bash
# Recipe name as positional parameter
ruly squash rails
ruly squash api
```

**Custom output file:**

```bash
# Squash mode with custom output
ruly squash --output-file=combined-rules.md
# or using short option
ruly squash -o docs/my-rules.md

# Combine with recipe
ruly squash rails -o RAILS.md
```

**Analyze token usage:**

```bash
# Analyze a specific recipe
ruly analyze rails
ruly analyze api

# Analyze all recipes
ruly analyze --all
ruly analyze -a
```

**Clean up generated files:**

```bash
# Clean all agent-related files for current agent
ruly clean

# Clean files from specific recipe
ruly clean rails

# Clean files for specific agent
ruly clean --agent cursor

# Dry run to see what would be deleted
ruly clean --dry-run
ruly clean -d

# Clean before squashing (remove old files first)
ruly squash --clean
ruly squash rails --clean
ruly squash -c  # Short form
```

### Recipe System

Recipes allow you to define collections of rules to combine, rather than always including all files.

**List available recipes:**

```bash
ruly list-recipes
```

**Use a specific recipe:**

```bash
# Use the 'core' recipe
ruly squash --recipe core

# Use 'testing' recipe with custom output
ruly squash --recipe testing -o testing-rules.md

# Short form
ruly squash -r minimal
```

#### Available Recipes

Recipes depend on having access to rule files. If you cloned with the default rules submodule, you'll have access to the recipes defined in `recipes.yml`. Otherwise, create your own recipes in `~/.config/ruly/recipes.yml` pointing to your rule sources.

#### Custom Recipes

Create a `~/.config/ruly/recipes.yml` file to define your own recipes or override existing ones:

```yaml
# ~/.config/ruly/recipes.yml
recipes:
  # Legacy format (still supported)
  my-legacy-project:
    - rules/core/core.md
    - rules/core/sequel.md
    - rules/workflow/pr-creation.md

  # New format: Local files with caching
  enhanced-rails:
    cache: true
    source: local
    files:
      - rules/ruby/*.md
      - rules/awesome-cursor.md
    remote_sources:
      # Individual files - use /blob/
      - https://github.com/danielscholl/mvn-mcp-server/blob/main/.claude/commands/bug-fix.md
      - https://github.com/example/repo/blob/main/rules/testing.md
      # Directories - use /tree/ (expands to all .md files)
      - https://github.com/example/repo/tree/main/rules/ruby

  # Minimal recipe with caching
  minimal-cached:
    cache: true
    source: local
    files:
      - rules/awesome-cursor.md
      - rules/core/core.md
      - rules/core/specs.md

  # Without caching
  docs-only:
    cache: false
    source: local
    files:
      - rules/workflow/*.md
      - rules/gateway/*.md
```

**Remote Sources:**

- Supports pulling rules directly from GitHub repositories
- Automatically converts GitHub blob URLs to raw URLs
- Command files (files with "command" in path/name) are saved to `.claude/commands/` when using
  `--agent claude`
- Non-Claude agents include all files in the main output

**GitHub URL Formats:**

- **Individual files**: Use `/blob/` URLs for specific files
  - Example: `https://github.com/owner/repo/blob/branch/path/to/file.md`
- **Directories**: Use `/tree/` URLs to include all `.md` files in a directory
  - Example: `https://github.com/owner/repo/tree/branch/path/to/directory`
  - Automatically expands to include all markdown files in that directory
- **Important**: Files with extensions (like `.md`) in `/tree/` URLs are treated as individual files, not directories

**Command File Handling:**

- When `--agent claude` (default), command files are saved to `.claude/commands/`
- For other agents, command files are included in the main output file
- Command detection: files in `/commands/` directories or with "command" in the filename

**Caching:**

- Use `--cache` flag to enable caching for any recipe
- Cached files are stored in `cache/<agent>/` directory
- Remote files are cached separately in `cache/remote/` (7-day expiration)
- Cache is disabled by default
- Use `ruly clean` to remove cache files

User recipes:

- Are automatically loaded from `~/.config/ruly/recipes.yml`
- Override base recipes with the same name
- Are stored in your home directory configuration
- Allow user-specific or team-specific customizations

### Commands

- **Squash** (`squash [RECIPE]`): Combines all rule content into a single large file. Recipe is
  optional positional parameter. Supports fetching remote GitHub files and caching for performance.
  Use `--toc` or `-t` to generate a table of contents with links to all headers and a list of available slash commands.

- **Analyze** (`analyze [RECIPE]`): Analyzes token usage for recipes without generating files. Shows
  detailed file breakdown and total token count. Use `--all` to analyze all recipes at once.

- **Clean** (`clean [RECIPE]`): Deletes output files created by the squash command. Recipe is
  optional and overrides metadata. Removes main output file and command files directory.

- **List Recipes** (`list-recipes`): Shows all available recipes with file counts and cache
  indicators.

- **Version** (`version`): Shows the current Ruly version.

### Slash Commands

Slash commands are special commands that can be defined in your rule files to provide quick actions for AI assistants. When you include command files in your rules (typically in a `commands/` directory), they become available as slash commands in the generated output.

For example, if you have a file `commands/bug/diagnose.md` in your rules, it would become available as `/bug:diagnose` when using the generated rules with Claude or other AI assistants.

The `--toc` option will automatically generate a list of all available slash commands in your squashed output, making them easy to discover and use.

### Examples

```bash
# Generate CLAUDE.local.md with all rules
ruly squash

# Dry run - see what would be created without creating it
ruly squash --dry-run
ruly squash -d

# Generate core rules only
ruly squash --recipe core
ruly squash -r core

# Generate squashed testing rules to a custom file
ruly squash -r testing -o test/testing-rules.md

# Generate rules for a different agent (e.g., cursor)
ruly squash -r rails --agent cursor -o CURSOR.md
ruly squash -r rails -a cursor -o CURSOR.md

# Generate with remote sources (command files go to .claude/commands/)
ruly squash -r example_mixed

# Use cached version (if recipe has cache: true)
ruly squash rails

# Bypass cache for one run
ruly squash rails --no-cache

# Clean up generated files
ruly clean

# Dry run - see what would be deleted
ruly clean --dry-run
ruly clean -d

# Clean specific output file
ruly clean -o test/testing-rules.md

# List what recipes are available
ruly list-recipes

# Show version
ruly version

# View help
ruly help
ruly help squash
ruly help clean
```

Ruly will automatically:

- Load recipes from both `recipes.yml` and `~/.config/ruly/recipes.yml`
- Support glob patterns in recipe definitions
- Create parent directories if using custom output paths
- Display file count and output size
- Show which recipe was used in the output

## ğŸ”§ Troubleshooting

### Common Issues

**Permission denied:**

- Ensure you have write access to your project directory
- Check that Ruby gems can be installed globally

**Recipe not found:**

- Run `ruly list-recipes` to see available recipes
- Check `~/.config/ruly/recipes.yml` for user-defined recipes
- Ensure recipe names match exactly (case-sensitive)

**Files not being cleaned:**

- Check `.ruly.yml` metadata file exists
- Use `ruly clean --dry-run` to preview what will be deleted
- Specify agent with `--agent` option if not using Claude
